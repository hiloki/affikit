/* background.html */
chrome.extension.onConnect.addListener(function(port) {
  console.assert(port.name == "AtoR");
  port.onMessage.addListener(function(msg) {
    if(msg.status == "start"){
      //楽天APIから商品を検索
      query = "http://api.rakuten.co.jp/rws/3.0/json?" +
          "developerId=" + devId +
          "&amp;affiliateId=" + afiId +
          "&amp;operation=" + opr +
          "&amp;version=" + ver+
          "&amp;keyword=" + encodeURI(msg.title);</p>
       api.open("GET",query,true);
       api.onreadystatechange = sourceGet(port);
       api.send(null);
    }
    else{
      sourceGet(port);
    }
  });
});

function sourceGet(port){
  console.log("sourceGet");
  if (api.readyState == 4 && api.status == 200){
    //APIからのレスポンスがきちんと返ってきた時の処理
    ・・・
  }
  else{
    if (loading === false){
      loading = true;
      content = '<img src="loading.gif" />';
    }
    port.postMessage({status: "loading"});
  }
}
